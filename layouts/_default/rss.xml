{{- $data := partial "feed.html" . -}}
{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>{{ $data.FeedTitle | safeHTML }}</title>
    <link>{{ .Permalink }}</link>
    <description>Recent content on {{ .Site.Title }}</description>
    <generator>Hugo</generator>
    <language>{{ site.Language.LanguageCode }}</language>
    {{ with $data.AuthorEmail }}<managingEditor>{{.}}{{ with $data.AuthorName }} ({{ . }}){{ end }}</managingEditor>{{ end }}
    {{ with $data.AuthorEmail }}<webMaster>{{ . }}{{ with $data.AuthorName }} ({{ . }}){{ end }}</webMaster>{{ end }}
    {{ with $data.Copyright }}<copyright>{{ . }}</copyright>{{ end }}
    {{ if not .Date.IsZero }}
    <lastBuildDate>{{ (index $data.Pages 0).Lastmod.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }}</lastBuildDate>
    {{ end }}
    {{- with .OutputFormats.Get "RSS" }}
    {{ printf `<atom:link href=%q rel="self" type=%q />` .Permalink .MediaType | safeHTML }}
    {{- end }}
    {{- with .Param "feed.hub" -}}
        {{ printf `<atom:link href=%q rel="hub" />` . | safeHTML }}
    {{- end -}}
    {{- range $data.Pages }}
    <item>
      <title>{{ .Title }}</title>
      <link>{{ .Permalink }}</link>
      <pubDate>{{ .PublishDate.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }}</pubDate>
      {{ with $data.AuthorEmail }}<author>{{ . }}{{ with $data.AuthorName }} ({{ . }}){{ end }}</author>{{ end }}
      <guid>{{ if .Params.uuid }}urn:uuid:{{ .Params.uuid }}{{ else }}{{ .Permalink }}{{ end }}</guid>
      <description>{{ .Summary | transform.XMLEscape | safeHTML }}</description>
      <content:encoded>
        {{- .Content
            | replaceRE "src=\"/" (printf "src=\"%s/" .Site.BaseURL)
            | replaceRE "href=\"/" (printf "href=\"%s/" .Site.BaseURL)
            | replaceRE "href=\"#" (printf "href=\"%s#" .Permalink)
            | transform.XMLEscape | safeHTML -}}
      </content:encoded>
      <source url="{{ .Permalink }}">
      {{ if eq .Title .Site.Title }}
      {{ .Site.Title }}
      {{ else }}
      {{ with .Title }}{{ . }} | {{ end }}{{ .Site.Title }}
      {{ end }}
      </source>
{{- $currentPage := . -}}
      {{- with site.Taxonomies -}}
        {{- range $taxo, $_ := . -}}
          {{- with $currentPage.Param $taxo -}}
            {{- range . -}}
              <category domain="{{ (site.GetPage $taxo).Permalink }}">{{ . }}</category>
            {{- end -}}
          {{- end -}}
        {{- end -}}
      {{- end -}}
    </item>
    {{ end }}
  </channel>
</rss>
